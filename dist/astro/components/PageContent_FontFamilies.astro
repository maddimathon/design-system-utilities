---
/**
 * @since 0.1.0-alpha.draft
 *
 * @packageDocumentation
 */

/* import - types */
import type { Tokens } from '../../ts/02-tokens/Tokens.js'; 
import type { Tokens_Typography } from '../../ts/02-tokens/Tokens_Typography.js';

/* import - functions */
import { arrayUnique, toTitleCase } from '@maddimathon/utility-typescript/functions';
import { objectMap } from '../../ts/01-utilities/objectMap.js';
 
/* import - values */

/* import - components */
import Toggle from '@maddimathon/utility-astro/components/Toggle';
// import VariableDump from '@maddimathon/utility-astro/components/VariableDump';

/* import - layouts */

/* TYPES ===================================== */

/* PROPS ===================================== */

export interface Props {
    tokens: Tokens.JsonReturn;
}

const { tokens }: Props = Astro.props;

/* FUNCTIONS ===================================== */

function detailsMapper( font: Tokens_Typography.Font.Family<string> ) {

    return Object.values( objectMap(
        font,
        ( { key, value } ) => {

            // returns on match
            switch (key) {

                case 'appendSystemFontsToFallbacks':
                case 'display':
                case 'weights':
                    return false;
 
                case 'fallbacks':
                    if(Array.isArray(value) ) {
                        return value.length ? {
                            key: 'Fallbacks',
                            value: value.join(', '),
                        } : false;
                    } else if (!value) {
                        return false;
                    }
                    break;

                case 'lineGapOverride':
                    return import.meta.env.DEV ? {
                        key: 'Line Gap Override',
                        value,
                    } : false;

                case 'sizeAdjust':
                    return {
                        key: 'Relative Size',
                        value,
                    };

                case 'slug':
                    return {
                        key: 'Role',
                        value,
                    };

                case 'unicodeRange':
                    return {
                        key: 'Unicode Range',
                        value,
                    };
            }
            
            return { 
                key: toTitleCase(key),
                value,
            };
        }
    ) ).filter( v => v !== false );
}

/* CONSTANTS ===================================== */

const defaultToggleToOpen = import.meta.env.DEV ? true : undefined;

const allFontLevels = arrayUnique(
    Object.values(tokens.typography.fonts)
        .map(({ weights }) =>
            Object.values(weights)
                .map((obj) => Object.values(obj).map( o => o.weight ))
                .flat()
        )
        .flat()
).sort();
---

<Toggle
    defaultOpen={defaultToggleToOpen}
    heading={2}
    id='sizes'
>
    <Fragment slot='button'>Font Weights</Fragment>
    <div 
        class='font-family-swatch-list'
        style={`--font-family-list-column-count: ${Object.keys( tokens.typography.fonts ).length}`}
    >
        {
            Object.values(tokens.typography.fonts).map((font) => (
                <article 
                    class='font-family-swatch'
                    style={`font-family: var(--ff-${font.slug}, "${font.name}")`}
                >
                    <h3
                        class:list={['font-family-swatch__name']}
                        set:text={font.name}
                    />
                    <dl class='font-family-swatch__details-list'>
                        { detailsMapper(font).map( ( {key, value} ) => (
                            <dt
                                class:list={[ 'font-family-swatch__details-dt' ]}
                                set:text={key} 
                            />
                            <dd
                                class:list={[ 'font-family-swatch__details-dd' ]}
                                set:text={value}
                            />
                        ) ) }
                    </dl>
                    {allFontLevels.map(( weight ) => font.weights[weight] && ( [ 'normal', 'italic' ] as const ).map( style => (
                        <h4
                            class:list={[
                                'font-family-swatch__weight-dt',
                                `font-family-swatch__weight-dt--${ style == 'italic' ? `${weight}-${style}` : weight }`, 
                            ]}
                            style={ [
                                `font-style: ${style}`,
                                // `font-weight: ${weight}`,
                            ].join(';') }
                            set:text={ style === 'italic' ? `${weight} (${style})`: weight }
                        />
                        <p
                            class:list={[
                                'font-family-swatch__weight-dd',
                                `font-family-swatch__weight-dd--${ style == 'italic' ? `${weight}-${style}` : weight }`,
                            ]}
                            style={ [
                                `font-style: ${style}`,
                                `font-weight: ${weight}`,
                            ].join(';') }
                            set:text={ import.meta.env.DEV
                                ? `Maecenas facilisis sollicitudin nisi, eget pellentesque dui rhoncus condimentum. Vivamus vulputate nisl sit amet vehicula commodo. Suspendisse pharetra varius ipsum, sed scelerisque ipsum tempor eget.`
                                : `Maecenas facilisis sollicitudin nisi, eget pellentesque dui rhoncus condimentum. Vivamus vulputate nisl sit amet.`
                            }
                            // set:text={`Maecenas facilisis sollicitudin nisi, eget pellentesque dui rhoncus condimentum. Vivamus vulputate nisl sit amet vehicula commodo. Suspendisse pharetra varius ipsum, sed scelerisque ipsum tempor eget. Curabitur mollis lacus eu augue vestibulum semper. Praesent rutrum velit sodales ante varius convallis. Proin ut gravida sem. Nulla ac sapien odio. Cras neque arcu, fermentum non elementum ac, tincidunt ut nibh. Proin blandit, nisl at volutpat pulvinar, massa nisl vulputate risus, eget porttitor neque mi id augue. Integer porttitor egestas facilisis. Quisque eget nibh hendrerit, ornare nisl sit amet, faucibus enim.`}
                        />
                    ) ))}
                </article>
            ))
        }
    </div>
</Toggle>

<style lang='scss'>
    @forward '../scss/page-content-font-families';
</style>
