---
/**
 * @since 0.1.0-alpha.draft
 *
 * @packageDocumentation
 */

/* import - types */
import type { Tokens } from '../../ts/02-tokens/Tokens.js';

/* import - functions */
import {
    arrayUnique,
    toTitleCase,
} from '@maddimathon/utility-typescript/functions';
import { objectMap } from '../../ts/01-utilities/objectMap.js';
import PageContent_Theme_Scripts from '../support/PageContent_Theme_Scripts.astro';

/* import - values */

/* import - components */
import Toggle from '@maddimathon/utility-astro/components/Toggle';
import ThemeModeSwatch from './ThemeModeSwatch.astro';
// import VariableDump from '@maddimathon/utility-astro/components/VariableDump';

/* import - layouts */

/* PROPS ===================================== */

export interface Props {
    // theme: Tokens.JsonReturn['themes'][keyof Tokens.JsonReturn['themes']];
    tokens: Tokens.JsonReturn;
}

const { tokens }: Props = Astro.props;

/* CONSTANTS ===================================== */

const defaultToggleToOpen = import.meta.env.DEV ? true : undefined;

const levelsInUse = arrayUnique(
    Object.values(tokens.themes)
        .map((theme) => theme.levelsInUse)
        .flat()
).sort();

const parsedSets = Object.values(
    objectMap(tokens.themes, ({ key, value: theme }) => ({
        key,
        parsed: Object.values(
            objectMap(theme, ({ key }) =>
                key === 'name'
                    ? false
                    : key === 'levelsInUse'
                      ? false
                      : key === 'forcedColours'
                        ? false
                        : {
                              name: key,
                              values: Object.values(
                                  objectMap(
                                  theme[key],
                                      ({ key: contrast, value: theme }) => ({
                                          id: `theme-${key}-${contrast}`,
                                          brightness: key,
                                          contrast,
                                          theme,
                                      })
                                  )
                              ),
                          }
            )
        ).filter((v) => v !== false),
    }))
);

const displayOptions = [
    {
        label: 'Preview',
        value: 'preview',
    },
    {
        label: 'Token values',
        value: 'tokens',
    },
] as const satisfies {
    label: string;
    value: string;
}[];
---

<p>
    The following colour shade levels are in use in at least one of the themes
    below: {
        levelsInUse.map((level, i) =>
            i < levelsInUse.length - 1 ? (
                <Fragment set:html={`<code>${level}</code>, `} />
            ) : (
                <Fragment set:html={`and <code>${level}</code>.`} />
            )
        )
    }
</p>

<div
    aria-ignore="true"
    class="theme-mode-preview-page__display-mode__wrapper"
>Display themes as: 
{ displayOptions.map( ( { label, value } ) => (
    <label class='theme-mode-preview-page__display-mode__label'><input 
        type='radio'
        class='theme-mode-preview-page__display-mode__label'
        name='theme-mode-preview-page__display-mode-control'
        value={value}
    /> {label}</label>
) ) }</div>

{
    parsedSets.map(({ key, parsed }) => (
        <h2 
            class='screen-reader-text'
            set:text={`${toTitleCase(key)} Theme`}
        />
        <Fragment>
            {parsed.map((brightnessSet) => ( 
                <Toggle
                    class='theme-mode-toggle'
                    defaultOpen={defaultToggleToOpen} 
                    displayHeading={2}
                    heading={3} 
                    id={`themes-${key}-${brightnessSet.name}-mode`}
                >
                    <Fragment 
                        set:text={toTitleCase(`${key} â€” ${brightnessSet.name} Mode`)}
                        slot='button'
                    />
                    { displayOptions.map( ( opt ) => (
                        <div
                            class:list={ [
                                'theme-mode-toggle__list', 
                            ] }
                            data-active-theme={key}
                            data-brightness-mode={brightnessSet.name}
                            data-theme-mode-preview-page-display-mode-content={opt.value}
                            style={`--theme-mode-swatch-list-column-count: ${brightnessSet.values.length};`}
                        >
                            { brightnessSet.values.map((set) => (
                                <ThemeModeSwatch
                                    {...set}
                                    brightness={brightnessSet.name}
                                    data-active-theme={key}
                                    displayMode={opt.value}
                                    heading={4}
                                    id={`${set.id}-swatch`}
                                    tokens={tokens}
                                >
                                    <Fragment
                                        slot='heading'
                                        set:text={`${toTitleCase(set.contrast)} Contrast`}
                                    />
                                </ThemeModeSwatch>
                            )) }
                        </div>
                    ) ) }
                </Toggle>
            ))}
        </Fragment>
    ))
}

<!-- {
    parsed.map((brightnessSet) => (
        <Toggle
            class='theme-mode-toggle'
            defaultOpen={defaultToggleToOpen}
            heading={2}
            id={`themes-${brightnessSet.name}-mode`}
        >
            <Fragment
                set:text={toTitleCase(`${brightnessSet.name} Mode`)}
                slot='button'
            />
            <div
                class='theme-mode-toggle__list'
                data-brightness-mode={brightnessSet.name}
                style={`--theme-mode-swatch-list-column-count: ${brightnessSet.values.length};`}
            >
                {brightnessSet.values.map((set) => (
                    <ThemeModeSwatch
                        {...set}
                        brightness={brightnessSet.name}
                        heading={3}
                        id={`${set.id}-swatch`}
                    >
                        <Fragment
                            slot='heading'
                            set:text={`${toTitleCase(set.contrast)} Contrast`}
                        />
                    </ThemeModeSwatch>
                ))}
            </div>
        </Toggle>
    ))
} -->

<PageContent_Theme_Scripts />

<style lang='scss'>
    @forward '../scss/page-content-theme';
</style>