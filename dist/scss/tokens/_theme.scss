///
/// @package @maddimathon/design-system-utilities@0.1.0-alpha.4
/// @since 0.1.0-alpha
///

@use '../config';

@use 'system';

@use 'pkg:@maddimathon/utility-sass/list';
@use 'pkg:@maddimathon/utility-sass/map';
@use 'pkg:@maddimathon/utility-sass/meta';

$_themeNames: map.keys(system.$themes);
$_defaultThemeName: list.nth($_themeNames, 1);

$activeTheme: null !default;
$activeTheme: config.config-valid-string(
    $activeTheme,
    'activeTheme',
    $default: $_defaultThemeName,
    $options: $_themeNames
);

$themes__nestedFlat: ();

@each $themeKey, $themeMap in system.$themes {
    //
    @each $brightness, $brightnessMap in $themeMap {
        @if $brightness == forced-colors {
            //
            $themes__nestedFlat: map.set(
                $themes__nestedFlat,
                $themeKey,
                $brightness,
                map.flatten(map.get($themeMap, $brightness))
            );
        } @else {
            //
            @each $contrast, $modeMap in $brightnessMap {
                $themes__nestedFlat: map.set(
                    $themes__nestedFlat,
                    $themeKey,
                    $brightness,
                    $contrast,
                    map.flatten($modeMap)
                );
            }
        }
    }
}

$brightnessMode_all: list.except(
    map.keys(map.get(system.$themes, $activeTheme)),
    'forced-colors'
);

$brightnessMode_default: null !default;
$brightnessMode_default: config.config-valid-string(
    $value: $brightnessMode_default,
    $name: 'brightnessMode_default',
    $default: list.nth($brightnessMode_all, 1),
    $options: $brightnessMode_all,
);

$contrastMode_all: list.unique(
    list.join(
        ('average'),
        list.join(
            map.keys(
                map.get(system.$themes, $activeTheme, $brightnessMode_default)
            ),
            ('forced-colors')
        )
    )
);

$contrastMode_default: null !default;
$contrastMode_default: config.config-valid-string(
    $value: $contrastMode_default,
    $name: 'contrastMode_default',
    $default: list.nth($contrastMode_all, 1),
    $options: $contrastMode_all,
);
