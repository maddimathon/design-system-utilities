///
/// @package @maddimathon/design-system-utilities@0.1.1-alpha.1.draft
/// @since 0.1.0-alpha
///

@use 'pkg:@maddimathon/utility-sass/math';
@use 'pkg:@maddimathon/utility-sass/meta';

@use '../../config';
@use '../../tokens';

@use '../01-functions' as *;
@use '../02-mixins' as *;

@use 'pkg:@maddimathon/utility-astro/03-snippets' as utils;

///
/// @since 0.1.1-alpha.0
///
@mixin snippet-link-colours($includeDisabled: true) {
    @include cx-prop(focus-ring-outline-color, var-theme(link-outline));
    @include cx-prop(icon-color, var-theme(link-icon));
    text-decoration-color: #{var-theme(link-decoration)};
    color: #{var-theme(link)};

    $location: root;
    // prettier-ignore
    @content($location);

    /// STATES ///

    &:visited {
        @include cx-prop(
            focus-ring-outline-color,
            var-theme(link-outline-visited)
        );
        @include cx-prop(icon-color, var-theme(link-icon-visited));
        text-decoration-color: #{var-theme(link-decoration-visited)};
        color: #{var-theme(link-visited)};

        $location: visited;
        // prettier-ignore
        @content($location);
    }

    @include hover-focus-visible() {
        @include cx-prop(
            focus-ring-outline-color,
            var-theme(link-outline-hover)
        );
        @include cx-prop(icon-color, var-theme(link-icon-hover));
        text-decoration-color: #{var-theme(link-decoration-hover)};
        color: #{var-theme(link-hover)};

        $location: hover-focus;
        // prettier-ignore
        @content($location);
    }

    &:active {
        @include cx-prop(
            focus-ring-outline-color,
            var-theme(link-outline-active)
        );
        @include cx-prop(icon-color, var-theme(link-icon-active));
        text-decoration-color: #{var-theme(link-decoration-active)};
        color: #{var-theme(link-active)};

        $location: active;
        // prettier-ignore
        @content($location);
    }

    @if $includeDisabled {
        &[aria-disabled='true'] {
            @include cx-prop(
                focus-ring-outline-color,
                var-theme(link-outline-disabled)
            );
            @include cx-prop(icon-color, var-theme(link-icon-disabled));
            text-decoration-line: underline;
            text-decoration-color: #{var-theme(link-decoration-disabled)};
            color: #{var-theme(link-disabled)};

            $location: root;
            // prettier-ignore
            @content($location);

            /// STATES ///

            @include hover-focus-visible() {
                @include cx-prop(
                    focus-ring-outline-color,
                    var-theme(link-outline-hover)
                );
                @include cx-prop(icon-color, var-theme(link-icon-hover));
                text-decoration-color: #{var-theme(link-decoration-hover)};
                color: #{var-theme(link-hover)};

                $location: hover-focus;
                // prettier-ignore
                @content($location);
            }

            &:active {
                @include cx-prop(
                    focus-ring-outline-color,
                    var-theme(link-outline-disabled)
                );
                @include cx-prop(icon-color, var-theme(link-icon-disabled));
                text-decoration-color: #{var-theme(link-decoration-disabled)};
                color: #{var-theme(link-disabled)};

                $location: active;
                // prettier-ignore
                @content($location);
            }
        }
    }
}

///
/// @since 0.1.1-alpha.0
///
@mixin snippet-link-colors-inherit(
    $color: inherit,
    $iconColor: do-var(icon-color),
    $textDecorationColor: var-theme(link-decoration),
    //
    $iconColor_disabled: var-theme(link-icon-disabled),
    $textDecorationColor_disabled: var-theme(link-decoration-disabled),
    $color_disabled: var-theme(link-disabled),
    //
    $includeDisabled: false,
    //
     //
) {
    @include cx-prop(icon-color, $iconColor);
    text-decoration-color: #{$textDecorationColor};
    color: #{$color};

    $location: root;
    // prettier-ignore
    @content($location);

    &:visited {
        @include cx-prop(icon-color, var-theme(link-icon-visited));
        text-decoration-color: #{var-theme(link-decoration-visited)};
        color: #{var-theme(link-visited)};

        $location: visited;
        // prettier-ignore
        @content($location);
    }

    @include hover-focus-visible() {
        @include cx-prop(icon-color, var-theme(link-icon-hover));
        text-decoration-color: #{var-theme(link-decoration-hover)};
        color: #{var-theme(link-hover)};

        $location: hover-focus;
        // prettier-ignore
        @content($location);
    }

    &:active {
        @include cx-prop(icon-color, var-theme(link-icon-active));
        text-decoration-color: #{var-theme(link-decoration-active)};
        color: #{var-theme(link-active)};

        $location: active;
        // prettier-ignore
        @content($location);
    }

    @if $includeDisabled {
        &[aria-disabled='true'] {
            @include cx-prop(icon-color, $iconColor_disabled);
            text-decoration-color: #{$textDecorationColor_disabled};
            color: #{$color_disabled};

            $location: disabled-root;
            // prettier-ignore
            @content($location);

            @include hover-focus-visible() {
                @include cx-prop(icon-color, var-theme(link-icon-hover));
                text-decoration-color: #{var-theme(link-decoration-hover)};
                color: #{var-theme(link-hover)};

                $location: disabled-hover-focus;
                // prettier-ignore
                @content($location);
            }

            &:active {
                @include cx-prop(icon-color, var-theme(link-icon-disabled));
                text-decoration-color: #{var-theme(link-decoration-disabled)};
                color: #{var-theme(link-disabled)};

                $location: disabled-active;
                // prettier-ignore
                @content($location);
            }
        }
    }
}

///
/// Adds basic rules for the given heading using tokens in the system.
///
/// @since 0.1.0-alpha
///
@mixin snippet-heading($slug: '7') {
    //
    @if $slug == title {
        $slug: '1';
    }

    $fontStyle: var-style(heading-#{$slug}-font-style);

    margin-block: #{var-style(heading-#{$slug}-margin-block-start)}
        #{var-style(heading-#{$slug}-margin-block-end)};

    @if font-family-exists(heading) {
        font-family: #{var-font-family(heading)};
    }

    font-weight: #{var-style(heading-#{$slug}-font-weight)};
    font-size: #{var-fs(heading-#{$slug})};
    line-height: #{var-style(heading-#{$slug}-line-height)};
    letter-spacing: #{var-style(heading-#{$slug}-letter-spacing)};

    text-transform: #{var-style(heading-#{$slug}-text-transform)};
    text-wrap: balance;

    font-style: #{$fontStyle};

    @if $fontStyle == italic {
        em {
            font-style: normal;

            em {
                font-style: italic;
            }
        }
    }

    color: #{var-theme(heading-#{$slug})};

    %a {
        @include snippet-link-colors-inherit;
        font-weight: inherit;
    }

    %code,
    %kbd,
    %samp {
        font-weight: inherit;
        font-style: inherit;
        color: inherit;
    }
}

///
/// Sets the paragraph margins using
///
/// @since 0.1.1-alpha.1.draft
///
@mixin set-default-margins(
    $paragraphLevel: '400',
    $firmStartLevel: null,
    $firmEndLevel: null
) {
    @if $firmStartLevel == null {
        $firmStartLevel: $paragraphLevel;
    }

    @if $firmEndLevel == null {
        $firmEndLevel: $firmStartLevel;
    }

    %paragraph-margins {
        margin-block: #{var-mrg-soft($paragraphLevel)} 0;
    }

    %button,
    %paragraph-firm-margins {
        margin-block: #{var-mrg-firm($firmStartLevel)}
            #{var-mrg-half($firmEndLevel)};
    }
}

///
/// @since 0.1.0-alpha
///
@mixin snippet-selection($contrast: tokens.$contrastMode_default) {
    //
    @include cx-prop(
        icon-color,
        var-theme(selection-text, $contrast: $contrast) !important
    );

    $bg_opacity: if(
        $contrast == 'average' or $contrast == 'low' or $contrast == 'high',
        do-var(
            selection-background-opacity,
            var-style(selection-background-opacity-#{$contrast})
        ),
        null
    );

    background-color: #{var-theme(
            selection-bg,
            $contrast: $contrast,
            $opacity: $bg_opacity
        )} !important;
    color: #{var-theme(selection-text, $contrast: $contrast)} !important;
}
