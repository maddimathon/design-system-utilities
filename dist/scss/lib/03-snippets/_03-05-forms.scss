///
/// @package @maddimathon/design-system-utilities@0.1.0-alpha
/// @since 0.1.0-alpha
///

@use 'pkg:@maddimathon/utility-sass/meta';

@use '../../config';
@use '../../tokens';

@use '../01-functions' as *;
@use '../02-mixins' as *;

@use '03-00-tokens' as *;
@use '03-03-typography' as *;

@use 'pkg:@maddimathon/utility-astro/03-snippets' as utils;

@mixin _snippet-button-colour-single-state($bg, $border, $text, $ui) {
    --icon-color: #{$ui};
    --theme-link-icon: #{$ui};
    text-decoration-color: #{$ui};
    accent-color: #{$border};
    background-color: #{$bg};
    border-color: #{$border};
    color: #{$text};
}

///
/// Colour properties for an input element.
///
/// @since 0.1.0-alpha
///
@mixin snippet-button-colours($variation: 'primary') {
    & {
        --focus-ring-outline-color: #{var-theme(
                button-#{$variation}-outline-hover
            )};
        @include _snippet-button-colour-single-state(
            $bg: var-theme(button-#{$variation}-bg),
            $border: var-theme(button-#{$variation}-border),
            $text: var-theme(button-#{$variation}-text),
            $ui: var-theme(button-#{$variation}-ui)
        );
    }

    @include hover-focus-visible-or-within {
        @include _snippet-button-colour-single-state(
            $bg: var-theme(button-#{$variation}-bg-hover),
            $border: var-theme(button-#{$variation}-border-hover),
            $text: var-theme(button-#{$variation}-text-hover),
            $ui: var-theme(button-#{$variation}-ui-hover)
        );
        text-decoration-color: var-theme(link-ui-hover);
    }

    &:active {
        --focus-ring-outline-color: #{var-theme(
                button-#{$variation}-outline-active
            )};
        @include _snippet-button-colour-single-state(
            $bg: var-theme(button-#{$variation}-bg-active),
            $border: var-theme(button-#{$variation}-border-active),
            $text: var-theme(button-#{$variation}-text-active),
            $ui: var-theme(button-#{$variation}-ui-active)
        );
    }
}

///
/// Base styles for a button element.
///
/// @since 0.1.0-alpha
///
@mixin snippet-button($includeDisabled: true, $variation: 'primary') {
    $fontStyle: var-style(button-font-style);

    --focus-ring-outline-offset: #{var-border-width(
            var-style(button-focus-offset)
        )};
    --icon-pseudo-element-margin-block-start: 0.09375em;

    --display: flex;
    display: flex;

    flex-direction: row;
    flex-wrap: wrap;

    justify-content: start;
    align-content: start;
    align-items: start;

    width: #{var-style(button-width)};

    margin-block: #{var-style(button-margin-block-start)}
        #{var-style(button-margin-block-end)};

    padding: #{var-style(button-padding-block)}
        #{var-style(button-padding-inline)};

    gap: #{var-style(button-gap-block)} #{var-style(button-gap-inline)};

    border-width: #{var-style(button-border-width)};
    border-radius: #{var-style(button-border-radius)};
    border-style: #{var-style(button-border-style)};

    font-weight: #{var-style(button-font-weight)};
    font-style: #{$fontStyle};
    font-size: #{var-fs(normal)};
    line-height: #{var-style(button-line-height)};
    letter-spacing: #{var-style(button-letter-spacing)};

    text-transform: #{var-style(button-text-transform)};
    text-decoration: none;
    text-wrap: balance;

    text-align: start;

    transition: var(--transition);
    opacity: 1;

    appearance: button;
    cursor: pointer;

    @include snippet-button-colours($variation);

    /// BLOCK ///

    @if $fontStyle == italic {
        em,
        i {
            font-style: normal;

            em,
            i {
                font-style: italic;
            }
        }
    }

    @if $includeDisabled {
        &[aria-disabled='true'] {
            cursor: not-allowed;
            @include snippet-button-colours(disabled);

            &::before {
                @if config.$template_button_inlineIcons {
                    @include snippet-icon-pseudo-element(
                        forbidden,
                        $pseudo: before
                    );
                }
            }
        }
    }

    * {
        --icon-color: inherit !important;
        color: inherit !important;
    }

    ::selection {
        @each $mode in tokens.$contrastMode_all {
            @include colour-mode($mode, $includeDefault: false) {
                @include snippet-selection($mode);
            }
        }
    }
}

///
/// Base styles for an input element.
///
/// @since 0.1.0-alpha
///
@mixin snippet-input($includeUtils: true, $args...) {
    $args: meta.keywords($args);

    $borderWidth: var-border-width('200');

    $accentClr: var-theme(field-accent);
    $accentClr_active: var-theme(field-accent-active);
    $accentClr_hover: var-theme(field-accent-hover);

    $background: var-theme(field-bg);
    $background_active: var-theme(field-bg-active);
    $background_hover: var-theme(field-bg-hover);

    $borderClr: var-theme(field-border);
    $borderClr_active: var-theme(field-border-active);
    $borderClr_hover: var-theme(field-border-hover);

    $color: var-theme(field-text);
    $color_active: var-theme(field-text-active);
    $color_hover: var-theme(field-text-hover);

    $focusOffset: var-border-width('300');

    @if $includeUtils {
        @include utils.snippet-input(
            $accentClr: $accentClr,
            $accentClr_active: $accentClr_active,
            $accentClr_hover: $accentClr_hover,

            $background: $background,
            $background_active: $background_active,
            $background_hover: $background_hover,

            $borderClr: $borderClr,
            $borderClr_active: $borderClr_active,
            $borderClr_hover: $borderClr_hover,

            $color: $color,
            $color_active: $color_active,
            $color_hover: $color_hover,

            $borderWidth: $borderWidth,
            $focusOffset: $focusOffset,
            $opacity_hover: 1,

            $includeClrs: true,
            $includePlaceholder: false,
            $args...
        );
    } @else {
        --focus-ring-outline-color: #{$accentClr_hover};
        --focus-ring-outline-offset: #{$focusOffset};
        background-color: #{$background};
        color: #{$color};
        accent-color: #{$accentClr};
        border-width: #{$borderWidth};

        @include hover-focus-visible-or-within {
            --focus-ring-outline-color: #{$accentClr_hover};
            background-color: #{$background_hover};
            border-color: #{$borderClr_hover};
            color: #{$color_hover};
            accent-color: #{$accentClr_hover};
        }

        &:active {
            --focus-ring-outline-color: #{$accentClr_active};
            background-color: #{$background_active};
            border-color: #{$borderClr_active};
            color: #{$color_active};
            accent-color: #{$accentClr_active};
        }
    }

    & {
        transition: var(--transition);
    }
}

///
/// Base styles for the types of an element. Uses the & as input.
///
/// @since 0.1.0-alpha
///
@mixin snippet-input-types(
    $includeUtils: true,
    //
    $accentClr: var-theme(field-border),
    $accentClr_active: var-theme(field-border-active),
    $accentClr_hover: var-theme(field-border-hover),
    $includeBase: true,
    $args...
) {
    $args: meta.keywords($args);

    @include utils.snippet-input-types(
        $accentClr: $accentClr,
        $accentClr_active: $accentClr_active,
        $accentClr_hover: $accentClr_hover,
        $includeBase: $includeBase,

        $includeClrs: true,
        $args...
    );

    &[type='submit'][disabled],
    &[type='reset'][disabled] {
        @include snippet-button-colours(disabled);
    }
}

///
/// Base styles for a form label, including check and radio boxes.
///
/// @since 0.1.0-alpha
///
@mixin snippet-label(
    $color: var-theme(text-primary),
    $color_checkradio: var-theme(text),
    //
    // $gap: var-mrg-soft('300'),
    // $lh_checkradio: var-line-height('400'),
    // $lh: var-line-height('200'),
    // $marginBlock_innercheckradio: var-mrg-firm('200'),
    // $marginBlock: var-mrg-firm('400')
    $args...
) {
    $args: meta.keywords($args);

    @if $includeUtils {
        @include utils.snippet-label(
            $color: $color,
            $color_checkradio: $color_checkradio,
            $includeClrs: true,
            $args...
        );
    }
}
