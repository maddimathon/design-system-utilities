///
/// @package @maddimathon/design-system-utilities@0.1.1-alpha.0.draft
/// @since 0.1.0-alpha
///
@use 'pkg:@maddimathon/utility-sass/feature-check';
@use 'pkg:@maddimathon/utility-sass/map';
@use 'pkg:@maddimathon/utility-sass/math';
@use 'pkg:@maddimathon/utility-sass/meta';

@use '../../config';
@use '../../tokens';

@use '../01-functions' as *;
@use '../02-mixins' as *;

@use 'pkg:@maddimathon/utility-astro/03-snippets' as utils;

$_closing_time: var-tr-time(toggle-closing);

///
/// Supports the SettingsMenu astro component.
///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-settings-menu {
    @include utils.snippet-support-astro-settings-menu;

    %aside {
        font-style: normal;
        font-size: #{var-fs(smaller-1)};

        em {
            font-style: italic;

            em {
                font-style: normal;

                em {
                    font-style: italic;
                }
            }
        }
    }

    .website-settings-menu {
        @include no-motion {
            @include cx-prop(toggle-closing-time, var-tr-time(normal));
        }
    }

    .website-settings__content {
        fieldset {
            transition: do-var(transition);

            > legend {
                color: #{var-theme(text-primary)};
            }
        }
    }

    .website-settings__disclaimer {
    }

    [data-toggle-control-backdrop] {
        transition: do-var(transition);
    }

    /* With Javascript ==================================== */

    [data-toggle-control] {
        .website-settings-menu &,
        .website-settings-menu[data-toggle-container='open'] & {
            border-radius: #{var-style(button-border-radius)};

            @include hover-focus-visible(
                $addSelectors: (
                    '&:active',
                )
            ) {
                color: #{var-theme(button-primary-text-hover)};
            }
        }
    }

    @include feature-check.js {
        .website-settings-menu {
            [data-toggle-control] {
                @include cx-prop(icon-color, currentColor);
            }

            > [data-toggle-content] {
                border-radius: #{var-style(button-border-radius)};
            }

            &[data-toggle-container='open'] {
                [data-toggle-control-backdrop] {
                    opacity: 0;
                    animation: fade-in #{var-tr-time(normal)} ease-in-out 10ms
                        forwards;
                }
            }

            &[data-toggle-container='closing'] {
                [data-toggle-control-backdrop] {
                    opacity: 0;
                    animation: fade-out #{var-tr-time(normal)} ease-in-out 0ms
                        forwards;
                }
            }
        }
    }
}

///
/// Supports font override settings (according to the tokens).
///
/// @since 0.1.0-alpha
///
@mixin snippet-support-astro-settings-menu-font-overrides {
    @each $slug, $map in map.get(tokens.$designSystem, font, familyOverrides) {
        //

        $attrSelector: '[data-font-family-override=#{$slug}]';

        $selectors: $attrSelector;

        @if map.has-key($map, labelClass) {
            $selectors: '#{$selectors}, #{$attrSelector} *, .website-settings-menu .#{map.get($map, labelClass)}';
        }

        @at-root #{$selectors} {
            font-family: #{var-font-family($slug)} !important;
        }

        @at-root #{$attrSelector} {
            @include font-family-size-tokens($slug);
        }
    }

    @at-root .website-settings-menu .font-family-override-default {
        font-family: #{var-font-family(body)} !important;
    }
}
