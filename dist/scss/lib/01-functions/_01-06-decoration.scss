///
/// @package @maddimathon/design-system-utilities@0.1.1-alpha.1.draft
/// @since 0.1.0-alpha
///

@use 'pkg:@maddimathon/utility-sass/map';
@use 'pkg:@maddimathon/utility-sass/math';

@use '../../config';
@use '../../tokens';

@use 'pkg:@maddimathon/utility-astro/01-functions' as utils;

///
/// Uses the border radius tokens to prepare the appropriate numerical value (rem).
///
/// @since 0.1.0-alpha
///
@function border-radius-value($level) {
    $value: map.get(tokens.$border, radius, #{$level});

    @if $value == null {
        @warn "$level '#{$level}' was not a key in tokens.$border['radius']";
        $value: map.get(tokens.$border, radius, '200');
    }

    @return calc(1rem * $value);
}

///
/// Used to make more visible borders and strokes for high-contrast modes.
///
/// @since 0.1.1-alpha.1.draft
///
@function clamp-high-contrast-border-width(
    $width,
    $unit: 1rem,
    $max_multiplier: null,
    $min_multiplier: null,
    $minmax_multiplier: 1
) {
    @if $max_multiplier == null {
        $max_multiplier: $minmax_multiplier;
    }

    @if $min_multiplier == null {
        $min_multiplier: $minmax_multiplier;
    }

    @return clamp(
        math.add-unit(
            math.clamp(
                config.$fn_clampHighContrastBorderWidth_min,
                math.round-to-pixel(
                    config.$fn_clampHighContrastBorderWidth_min *
                        $min_multiplier
                ),
                0.25
            ),
            $unit,
            // TODO
             // $method: ceil,
        ),
        $width,
        math.clamp(
            config.$fn_clampHighContrastBorderWidth_max,
            math.ceil(
                config.$fn_clampHighContrastBorderWidth_max * $max_multiplier
            ),
            8px
        )
    );
}

///
/// Uses the icon tokens to return a url('...') value.
///
/// @since 0.1.0-alpha
///
@function icon-aspect-ratio-value($slug) {
    // returns
    @if not map.has-key(tokens.$icons, $slug) {
        @warn "$slug '#{$slug}' was not a key in tokens.$icons";
        @return $slug;
    }

    $value: map.get(tokens.$icons, $slug, aspectRatio);

    // returns
    @if $value == null {
        @warn "'aspectRatio' was not a key in tokens.$icons.#{$slug}";
        @return $slug;
    }

    @return $value;
}

///
/// Uses the icon tokens to return its aspect ratio.
///
/// @since 0.1.0-alpha
///
@function icon-embedded-value($slug) {
    // returns
    @if not map.has-key(tokens.$icons, $slug) {
        @warn "$slug '#{$slug}' was not a key in tokens.$icons";
        @return $slug;
    }

    $value: map.get(tokens.$icons, $slug, embedded);

    // returns
    @if $value == null {
        @warn "'embedded' was not a key in tokens.$icons.#{$slug}";
        @return $slug;
    }

    @return $value;
}

///
/// Uses the icon tokens to return its label value.
///
/// @since 0.1.0-alpha
///
@function icon-label-value($slug) {
    // returns
    @if not map.has-key(tokens.$icons, $slug) {
        @warn "$slug '#{$slug}' was not a key in tokens.$icons";
        @return $slug;
    }

    $value: map.get(tokens.$icons, $slug, label);

    // returns
    @if $value == null {
        @warn "'label' was not a key in tokens.$icons.#{$slug}";
        @return $slug;
    }

    @return $value;
}

///
/// Uses the logo tokens to return a url('...') value.
///
/// @since 0.1.0-alpha.3
///
@function logo-aspect-ratio-value($slug) {
    // returns
    @if not map.has-key(tokens.$logos, $slug) {
        @warn "$slug '#{$slug}' was not a key in tokens.$logos";
        @return $slug;
    }

    $value: map.get(tokens.$logos, $slug, aspectRatio);

    // returns
    @if $value == null {
        @warn "'aspectRatio' was not a key in tokens.$logos.#{$slug}";
        @return $slug;
    }

    @return $value;
}

///
/// Uses the logo tokens to return its aspect ratio.
///
/// @since 0.1.0-alpha.3
///
@function logo-embedded-value($slug) {
    // returns
    @if not map.has-key(tokens.$logos, $slug) {
        @warn "$slug '#{$slug}' was not a key in tokens.$logos";
        @return $slug;
    }

    $value: map.get(tokens.$logos, $slug, embedded);

    // returns
    @if $value == null {
        @warn "'embedded' was not a key in tokens.$logos.#{$slug}";
        @return $slug;
    }

    @return $value;
}

///
/// Uses the logo tokens to return its label value.
///
/// @since 0.1.0-alpha.3
///
@function logo-label-value($slug) {
    // returns
    @if not map.has-key(tokens.$logos, $slug) {
        @warn "$slug '#{$slug}' was not a key in tokens.$logos";
        @return $slug;
    }

    $value: map.get(tokens.$logos, $slug, label);

    // returns
    @if $value == null {
        @warn "'label' was not a key in tokens.$logos.#{$slug}";
        @return $slug;
    }

    @return $value;
}

///
/// Uses the border-radius config tokens to print the appropriate var(...) with
/// a fallback.
///
/// @since 0.1.0-alpha
///
@function var-border-radius($level) {
    @return if(
        config.$fn_var_replaceWithValue_borderRadius,
        border-radius-value($level),
        utils.do-var(border-radius-#{$level}, border-radius-value($level))
    );
}

///
/// Uses the border-width config tokens to print the appropriate var(...) with
/// a fallback.
///
/// @since 0.1.0-alpha
///
@function var-border-width($level) {
    @return if(
        config.$fn_var_replaceWithValue_borderWidth,
        utils.border-width-value($level),
        utils.do-var(border-width-#{$level}, utils.border-width-value($level))
    );
}

///
/// Uses the stroke-relative config tokens to print the appropriate var(...) with
/// a fallback.
///
/// @since 0.1.0-alpha
///
@function var-stroke-relative($level) {
    @return if(
        config.$fn_var_replaceWithValue_strokeRelative,
        utils.stroke-relative-value($level),
        utils.do-var(
            stroke-relative-#{$level},
            utils.stroke-relative-value($level)
        )
    );
}

///
/// Uses the border radius config tokens to print the appropriate var(...) with
/// a fallback.
///
/// @since 0.1.0-alpha
///
@function var-z-index($level) {
    @return if(
        config.$fn_var_replaceWithValue_zIndex,
        z-index-value($level),
        utils.do-var(z-index-#{$level}, z-index-value($level))
    );
}

///
/// Uses the transition time tokens to prepare the appropriate numerical value
/// (rem).
///
/// @since 0.1.0-alpha
///
@function z-index-value($level) {
    $value: map.get(tokens.$z_index, #{$level});

    // returns
    @if $value == null {
        @warn "$level '#{$level}' was not a key in tokens.$z_index";
        @return $level;
    }

    @return $value;
}
