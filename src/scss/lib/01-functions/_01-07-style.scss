///
/// @package @maddimathon/design-system-utilities@___CURRENT_VERSION___
/// @since 0.1.0-alpha
///

@use 'pkg:@maddimathon/utility-sass/map';
@use 'pkg:@maddimathon/utility-sass/math';
@use 'pkg:@maddimathon/utility-sass/string';

@use '../../config';
@use '../../tokens';

@use 'pkg:@maddimathon/utility-astro/01-functions' as utils;

@use '01-03-colours' as *;
@use '01-06-decoration' as *;

$_flattenedStyles: map.flatten(map.get(tokens.$designSystem, style));

///
/// Uses the (flattened) style tokens.
///
/// @since 0.1.0-alpha
///
@function style-value($slug) {
    $value: map.get($_flattenedStyles, $slug);

    // returns
    @if $value == null {
        @warn "$slug '#{$slug}' was not a key in flattened tokens.$designSystem.style";
        @return $slug;
    }

    $isAlertStyle: string.index($slug, alert-) == 1;
    $isButtonStyle: string.index($slug, button-) == 1;
    $isHeadingStyle: string.index($slug, heading-) == 1;
    $isInputStyle: string.index($slug, input-) == 1;

    $isBorderRadius: false;
    $isBorderWidth: false;
    $isLineHeight: false;
    $isGap: false;
    $isMargin: false;
    $isPadding: false;
    $isStrokeRelative: false;
    $isThemeToken: false;

    $isSimpleEm: false;

    $_slugLength: string.length($slug);

    @if $isAlertStyle or $isButtonStyle or $isInputStyle or $isHeadingStyle {
        // gap
        @if string.index($slug, -gap-) {
            $isGap: true;
        } @else if string.index($slug, '-gap') == ($_slugLength - 6) {
            $isGap: true;
        }

        // theme (colour) tokens
        @if string.index($slug, '-background-') {
            $isThemeToken: true;
        } @else if string.index($slug, '-color-') {
            $isThemeToken: true;
        } @else if string.index($slug, '-background') == ($_slugLength - 10) {
            $isThemeToken: true;
        } @else if string.index($slug, '-color') == ($_slugLength - 5) {
            $isThemeToken: true;
        }

        // margins
        @if $isAlertStyle and string.index($slug, '-margin-default') == ($_slugLength - 14) {
        } @else if string.index($slug, '-margin-') {
            $isMargin: true;
        } @else if string.index($slug, '-margin') == ($_slugLength - 6) {
            $isMargin: true;
        }

        // padding
        @if string.index($slug, '-padding-') {
            @if $isAlertStyle {
                $isMargin: true;
            } @else {
                $isPadding: true;
            }
        } @else if string.index($slug, '-padding') == ($_slugLength - 7) {
            @if $isAlertStyle {
                $isMargin: true;
            } @else {
                $isPadding: true;
            }
        }

        // border-radius
        @if string.index($slug, '-border-radius') == ($_slugLength - 13) {
            $isBorderRadius: true;
        }

        // border-width
        @if string.index($slug, '-border-width') == ($_slugLength - 12) {
            $isBorderWidth: true;
        }

        // stroke-relative
        @if string.index($slug, '-focus-offset') {
            $isStrokeRelative: true;
        }

        // line-height
        @if string.index($slug, '-line-height') == ($_slugLength - 11) {
            $isLineHeight: true;
        }
    }

    @if $isAlertStyle {
        // icon size
        @if string.index($slug, '-icon-size') == ($_slugLength - 9) {
            $isSimpleEm: true;
        }
    }

    @if $isMargin {
        //
        @if string.index($slug, margin-block-start) {
            $value: if(
                $isButtonStyle or $isInputStyle,
                utils.var-mrg-firm($value),
                utils.var-mrg-soft($value)
            );
        } @else if string.index($slug, margin-block-end) {
            $value: utils.var-mrg-half($value);
        } @else if string.index($slug, margin-block) {
            $value: if(
                $isButtonStyle or $isInputStyle,
                utils.var-mrg-firm($value),
                utils.var-mrg-soft($value)
            );
        } @else {
            $value: utils.var-mrg-firm($value);
        }
    } @else if $isPadding {
        //
        @if string.index($slug, padding-block-start) {
            $value: utils.var-pad-soft($value);
        } @else if string.index($slug, padding-block-end) {
            $value: utils.var-pad-half($value);
        } @else if string.index($slug, padding-block) {
            $value: if($isAlertStyle, utils.var-pad-firm($value), utils.var-pad-soft($value));
        } @else {
            $value: utils.var-pad-firm($value);
        }
    } @else if $isGap {
        //
        @if $value == '0' {
            $value: 0;
        } @else if string.index($slug, gap-block-start) {
            $value: utils.var-mrg-soft($value);
        } @else if string.index($slug, gap-block-end) {
            $value: utils.var-mrg-half($value);
        } @else if string.index($slug, gap-block) {
            $value: utils.var-mrg-soft($value);
        } @else {
            $value: utils.var-mrg-firm($value);
        }
    } @else if $isBorderRadius {
        $value: if($value == '0', $value, var-border-radius($value));
    } @else if $isBorderWidth {
        $value: var-border-width($value);
    } @else if $isLineHeight {
        $value: utils.var-line-height($value);
    } @else if $isStrokeRelative {
        $value: utils.var-stroke-relative($value);
    } @else if $isThemeToken {
        $value: var-theme($value);
    } @else if $isSimpleEm {
        $value: math.add-unit($value, $unit: 1em);
    }

    @return $value;
}

///
/// @since 0.1.0-alpha
///
@function var-style($slug) {
    @return if(
        config.$fn_var_replaceWithValue_style,
        style-value($slug),
        utils.do-var(style-#{$slug}, #{style-value($slug)})
    );
}
