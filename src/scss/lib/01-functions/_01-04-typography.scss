///
/// @package @maddimathon/design-system-utilities@___CURRENT_VERSION___
/// @since ___PKG_VERSION___
///

@use 'pkg:@maddimathon/utility-sass/list';
@use 'pkg:@maddimathon/utility-sass/map';
@use 'pkg:@maddimathon/utility-sass/meta';
@use 'pkg:@maddimathon/utility-sass/string';

@use '../../config';
@use '../../tokens';

@use 'pkg:@maddimathon/utility-astro/01-functions' as utils;

$_designSystemHasFontFamilies: map.has-key(tokens.$designSystem, font, family)
    and list.length(map.keys(map.get(tokens.$designSystem, font, family))) > 0;

@function tokens-has-font-families() {
    @return $_designSystemHasFontFamilies;
}

///
/// @since ___PKG_VERSION___
///
@function font-family-exists($slug) {
    // returns
    @if not map.has-key(tokens.$designSystem, font, family) {
        @return false;
    }

    @return map.has-key(tokens.$designSystem, font, family, $slug);
}

///
/// @since ___PKG_VERSION___
///
@function font-family-list($slug) {
    // returns
    @if not map.has-key(tokens.$designSystem, font, family) {
        @warn 'there are no font family tokens';
        @return utils.font-family-system-ui();
    }

    // returns
    @if not map.has-key(tokens.$designSystem, font, family, $slug) {
        @warn "$slug '#{$slug}' was not a key in the font family tokens";
        @return utils.font-family-system-ui();
    }

    $fontMap: map.get(
        tokens.$designSystem,
        font,
        family,
        $slug,
        weights,
        '400',
        normal
    );

    @return utils.font-list(
        list.join(
            (map.get($fontMap, family)),
            map.get($fontMap, fallbacks),
            $separator: comma
        )
    );
}

///
/// @since ___PKG_VERSION___
///
@function var-font-family($slug) {
    @return if(
        config.$fn_var_replaceWithValue_fontFamily,
        font-family-list($slug),
        var(--ff-#{$slug}, font-family-list($slug))
    );
}

///
/// @since ___PKG_VERSION___
///
@function var-fs($slug, $fallback: null) {
    // returns
    @if config.$fn_var_replaceWithValue_fontSize {
        @return if(
            $fallback == null,
            list.nth(utils.fs-value($slug), 1),
            $fallback
        );
    }

    @return utils.var-fs($slug, $fallback: $fallback);
}
