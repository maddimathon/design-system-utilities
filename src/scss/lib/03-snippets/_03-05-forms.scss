///
/// @package @maddimathon/design-system-utilities@___CURRENT_VERSION___
/// @since 0.1.0-alpha
///

@use 'pkg:@maddimathon/utility-sass/meta';

@use '../../config';
@use '../../tokens';

@use '../01-functions' as *;
@use '../02-mixins' as *;

@use '03-00-tokens' as *;
@use '03-03-typography' as *;

@use 'pkg:@maddimathon/utility-astro/03-snippets' as utils;

@mixin _snippet-button-colour-single-state($bg, $border, $text, $ui, $focusRing) {
    @include cx-prop(focus-ring-outline-color, $focusRing);
    @include cx-prop(icon-color, $ui);
    @include cx-prop(theme-link-icon, $ui);

    text-decoration-color: #{$ui};
    accent-color: #{$border};
    background-color: #{$bg};
    border-color: #{$border};
    color: #{$text};
}

///
/// Colour properties for an input element.
///
/// @since 0.1.0-alpha
///
@mixin snippet-button-colours($variation: 'primary') {
    $_content_exits: meta.content-exists();

    & {
        @include _snippet-button-colour-single-state(
            $bg: var-theme(button-#{$variation}-bg),
            $border: var-theme(button-#{$variation}-border),
            $text: var-theme(button-#{$variation}-text),
            $ui: var-theme(button-#{$variation}-ui),
            $focusRing: var-theme(button-#{$variation}-outline-hover)
        );
        @if $_content_exits {
            @content ( $location: 'root' );
        }
    }

    @include focus-visible-or-within {
        @include _snippet-button-colour-single-state(
            $bg: var-theme(button-#{$variation}-bg-hover),
            $border: var-theme(button-#{$variation}-border-hover),
            $text: var-theme(button-#{$variation}-text-hover),
            $ui: var-theme(button-#{$variation}-ui-hover),
            $focusRing: var-theme(button-#{$variation}-outline-hover)
        );
        @if $_content_exits {
            @content ( $location: 'focus' );
        }
    }

    &:hover {
        @include _snippet-button-colour-single-state(
            $bg: var-theme(button-#{$variation}-bg-hover),
            $border: var-theme(button-#{$variation}-border-hover),
            $text: var-theme(button-#{$variation}-text-hover),
            $ui: var-theme(button-#{$variation}-ui-hover),
            $focusRing: var-theme(button-#{$variation}-outline-hover)
        );
        @if $_content_exits {
            @content ( $location: 'hover' );
        }
    }

    &:active {
        @include _snippet-button-colour-single-state(
            $bg: var-theme(button-#{$variation}-bg-active),
            $border: var-theme(button-#{$variation}-border-active),
            $text: var-theme(button-#{$variation}-text-active),
            $ui: var-theme(button-#{$variation}-ui-active),
            $focusRing: var-theme(button-#{$variation}-outline-active)
        );
        @if $_content_exits {
            @content ( $location: 'active' );
        }
    }
}

///
/// Base styles for a button element.
///
/// @since 0.1.0-alpha
///
@mixin snippet-button(
    $fontWeight: var-style(button-font-weight),
    $fontWeight_disabled: var-style(button-disabled-font-weight),
    $fontSize: var-fs(normal),
    $fontStyle: var-style(button-font-style),
    $fontStyle_disabled: var-style(button-disabled-font-style),
    $includeColors: true,
    $includeDisabled: true,
    $includePseudoIcons: config.$template_button_inlineIcons,
    $variation: 'primary'
) {
    $_content_exits: meta.content-exists();

    @include cx-prop(focus-ring-outline-offset, var-style(button-focus-offset));

    @include cx-prop(display, flex);
    display: flex;

    flex-direction: row;
    flex-wrap: wrap;

    justify-content: start;
    align-content: start;
    align-items: start;

    width: #{var-style(button-width)};

    margin-block: #{var-style(button-margin-block-start)} #{var-style(button-margin-block-end)};
    padding: #{var-style(button-padding-block)} #{var-style(button-padding-inline)};

    gap: #{var-style(button-gap-block)} #{var-style(button-gap-inline)};

    border-width: #{var-style(button-border-width)};
    border-radius: #{var-style(button-border-radius)};
    border-style: #{var-style(button-border-style)};

    font-weight: #{$fontWeight};
    font-style: #{$fontStyle};
    font-size: #{$fontSize};
    line-height: #{var-style(button-line-height)};
    letter-spacing: #{var-style(button-letter-spacing)};

    text-transform: #{var-style(button-text-transform)};
    text-decoration: none;
    text-wrap: balance;

    text-align: start;

    transition: do-var(transition);
    opacity: 1;

    appearance: button;
    cursor: pointer;

    @if $includeColors {
        @include snippet-button-colours($variation) using ($location) {
            @content ($location);
        }
    } @else {
        & {
            @if $_content_exits {
                @content ( $location: 'root' );
            }
        }

        @include hover-focus-visible-or-within {
            @if $_content_exits {
                @content ( $location: 'focus' );
            }
        }

        &:hover {
            @if $_content_exits {
                @content ( $location: 'hover' );
            }
        }

        &:active {
            @if $_content_exits {
                @content ( $location: 'active' );
            }
        }
    }

    /// BLOCK ///

    @if $fontStyle == italic {
        em {
            font-style: normal;

            em {
                font-style: italic;
            }
        }
    }

    @if $includeDisabled {
        &[aria-disabled='true'],
        &[disabled] {
            @include snippet-button-disabled(
                    $fontWeight: $fontWeight_disabled,
                    $fontStyle: $fontStyle_disabled,
                    $includeColors: $includeColors,
                    $includePseudoIcons: $includePseudoIcons
                )
                using ($location) {
                @content ($location: 'disabled-#{$location}');
            }
        }
        &[readonly] {
            cursor: not-allowed;
        }
    }

    * {
        @include cx-prop(icon-color, inherit !important);
        color: inherit !important;
    }

    %code,
    %kbd,
    %samp {
        padding: 0;
        font-weight: inherit;
        font-style: inherit;
        background: transparent;
    }

    %icon {
        align-self: center;
    }
}

///
/// Override styles for a disabled button element (assuming snippet-button was
/// assigned to the base element/selector).
///
/// @since 0.1.1-alpha.0
///
@mixin snippet-button-disabled(
    $fontWeight: var-style(button-disabled-font-weight),
    $fontStyle: var-style(button-disabled-font-style),
    $includeColors: true,
    $includePseudoIcons: config.$template_button_inlineIcons
) {
    border-radius: #{var-style(button-disabled-border-radius)};
    border-style: #{var-style(button-disabled-border-style)};

    font-weight: #{$fontWeight};
    font-style: #{$fontStyle};

    letter-spacing: #{var-style(button-disabled-letter-spacing)};
    text-transform: #{var-style(button-disabled-text-transform)};

    cursor: not-allowed;

    @if $includeColors {
        @include snippet-button-colours(disabled) using ($location) {
            @if $location == focus {
                border-style: solid;
            }
            @content ($location);
        }
    } @else {
        & {
            @if $_content_exits {
                @content ( $location: 'root' );
            }
        }

        @include focus-visible-or-within {
            border-style: solid;

            @if $_content_exits {
                @content ( $location: 'focus' );
            }
        }

        &:hover {
            @if $_content_exits {
                @content ( $location: 'hover' );
            }
        }

        &:active {
            @if $_content_exits {
                @content ( $location: 'active' );
            }
        }
    }

    &::before {
        @if $includePseudoIcons {
            @include snippet-icon-pseudo-element(forbidden, $pseudo: before) {
                align-self: center;
            }
        }
    }
}

///
/// @since 0.1.1-alpha.0
///
@mixin _snippet-input-colours-single(
    $accentClr,
    $accentClr_active,
    $accentClr_hover,
    //
    $background,
    $background_active,
    $background_hover,
    //
    $borderClr,
    $borderClr_active,
    $borderClr_hover,
    //
    $color,
    $color_active,
    $color_hover,
    //
    $opacity: true
) {
    @include cx-prop(focus-ring-outline-color, $accentClr);
    background-color: #{$background};
    border-color: #{$borderClr};
    color: #{$color};
    accent-color: #{$accentClr};

    &::placeholder {
        color: #{var-theme(input-placeholder)};
    }

    @include hover-focus-visible-or-within {
        @include cx-prop(focus-ring-outline-color, $accentClr_hover);
        background-color: #{$background_hover};
        border-color: #{$borderClr_hover};
        color: #{$color_hover};
        accent-color: #{$accentClr_hover};

        @if $opacity {
            opacity: 1;
        }
    }

    &:active {
        @include cx-prop(focus-ring-outline-color, $accentClr_active);
        background-color: #{$background_active};
        border-color: #{$borderClr_active};
        color: #{$color_active};
        accent-color: #{$accentClr_active};

        @if $opacity {
            opacity: 1;
        }
    }
}

///
/// Snippet input colours.
///
/// @since 0.1.1-alpha.0
///
@mixin snippet-input-colours(
    $accentClr: var-theme(input-accent),
    $accentClr_active: var-theme(input-accent-active),
    $accentClr_hover: var-theme(input-accent-hover),
    //
    $background: var-theme(input-bg),
    $background_active: var-theme(input-bg-active),
    $background_hover: var-theme(input-bg-hover),
    //
    $borderClr: var-theme(input-border),
    $borderClr_active: var-theme(input-border-active),
    $borderClr_hover: var-theme(input-border-hover),
    //
    $color: var-theme(input-text),
    $color_active: var-theme(input-text-active),
    $color_hover: var-theme(input-text-hover),
    //
    $accentClr_disabled: var-theme(input-disabled-accent),
    $accentClr_disabled_active: var-theme(input-disabled-accent-active),
    $accentClr_disabled_hover: var-theme(input-disabled-accent-hover),
    //
    $background_disabled: var-theme(input-disabled-bg),
    $background_disabled_active: var-theme(input-disabled-bg-active),
    $background_disabled_hover: var-theme(input-disabled-bg-hover),
    //
    $borderClr_disabled: var-theme(input-disabled-border),
    $borderClr_disabled_active: var-theme(input-disabled-border-active),
    $borderClr_disabled_hover: var-theme(input-disabled-border-hover),
    //
    $color_disabled: var-theme(input-disabled-text),
    $color_disabled_active: var-theme(input-disabled-text-active),
    $color_disabled_hover: var-theme(input-disabled-text-hover),
    //
    $accentClr_readonly: var-theme(input-readonly-accent),
    $accentClr_readonly_active: var-theme(input-readonly-accent-active),
    $accentClr_readonly_hover: var-theme(input-readonly-accent-hover),
    //
    $background_readonly: var-theme(input-readonly-bg),
    $background_readonly_active: var-theme(input-readonly-bg-active),
    $background_readonly_hover: var-theme(input-readonly-bg-hover),
    //
    $borderClr_readonly: var-theme(input-readonly-border),
    $borderClr_readonly_active: var-theme(input-readonly-border-active),
    $borderClr_readonly_hover: var-theme(input-readonly-border-hover),
    //
    $color_readonly: var-theme(input-readonly-text),
    $color_readonly_active: var-theme(input-readonly-text-active),
    $color_readonly_hover: var-theme(input-readonly-text-hover) //
) {
    @include _snippet-input-colours-single(
        $accentClr: $accentClr,
        $accentClr_active: $accentClr_active,
        $accentClr_hover: $accentClr_hover,
        //
        $background: $background,
        $background_active: $background_active,
        $background_hover: $background_hover,
        //
        $borderClr: $borderClr,
        $borderClr_active: $borderClr_active,
        $borderClr_hover: $borderClr_hover,
        //
        $color: $color,
        $color_active: $color_active,
        $color_hover: $color_hover
    );

    &[aria-disabled='true'],
    &[disabled] {
        @include _snippet-input-colours-single(
            $accentClr: $accentClr_disabled,
            $accentClr_active: $accentClr_disabled_active,
            $accentClr_hover: $accentClr_disabled_hover,
            //
            $background: $background_disabled,
            $background_active: $background_disabled_active,
            $background_hover: $background_disabled_hover,
            //
            $borderClr: $borderClr_disabled,
            $borderClr_active: $borderClr_disabled_active,
            $borderClr_hover: $borderClr_disabled_hover,
            //
            $color: $color_disabled,
            $color_active: $color_disabled_active,
            $color_hover: $color_disabled_hover,
            //
            $opacity: false
        );
    }

    &[readonly] {
        @include _snippet-input-colours-single(
            $accentClr: $accentClr_readonly,
            $accentClr_active: $accentClr_readonly_active,
            $accentClr_hover: $accentClr_readonly_hover,
            //
            $background: $background_readonly,
            $background_active: $background_readonly_active,
            $background_hover: $background_readonly_hover,
            //
            $borderClr: $borderClr_readonly,
            $borderClr_active: $borderClr_readonly_active,
            $borderClr_hover: $borderClr_readonly_hover,
            //
            $color: $color_readonly,
            $color_active: $color_readonly_active,
            $color_hover: $color_readonly_hover,
            //
            $opacity: false
        );
    }
}

///
/// Base styles for an input element.
///
/// @since 0.1.0-alpha
///
@mixin snippet-input(
    $borderWidth: var-style(input-border-width),
    $focusOffset: var-style(input-focus-offset),
    $lineHeight: var-style(input-line-height),
    $margin: var-style(input-margin-block-start) 0 var-style(input-margin-block-end),
    $marginBlockStart_afterLabel: var-style(input-margin-block-gap),
    $padding: var-style(input-padding-block) var-style(input-padding-inline),
    //
    $includeDisabled: true,
    $includeLabel: true,
    $includeUtils: true,
    $args...
) {
    $args: meta.keywords($args);

    @if $includeUtils {
        @include utils.snippet-input(
            $borderWidth: $borderWidth,
            $focusOffset: $focusOffset,
            $lineHeight: $lineHeight,
            $margin: $margin,
            $marginBlockStart_afterLabel: $marginBlockStart_afterLabel,
            $opacity_hover: 1,
            $padding: $padding,
            //
            $includeClrs: false,
            $includePlaceholder: false,
            $args...
        );
    }

    & {
        @if not $includeUtils {
            @include cx-prop(focus-ring-outline-offset, $focusOffset);
            margin: #{$margin};
            padding: #{$padding};
            border-width: #{$borderWidth};
            line-height: #{$lineHeight};
        }

        transition: do-var(transition);

        &::placeholder {
            font-style: #{var-style(input-placeholder-font-style)};
            opacity: 1;

            @each $contrast in (low, average) {
                @include colour-mode($contrast, $includeDefault: false) {
                    opacity: #{var-style(input-placeholder-opacity-#{$contrast})};
                }
            }
        }

        @if not $includeUtils and $includeLabel {
            label + &,
            label > & {
                margin-block-start: #{$marginBlockStart_afterLabel};
            }
        }
    }

    @include snippet-input-colours($args...);
}

///
/// Base styles for the types of an element. Uses the & as input.
///
/// @since 0.1.0-alpha
///
@mixin snippet-input-types(
    $includeBase: true,
    $includeUtils: true,
    //
    $args...
) {
    $args: meta.keywords($args);

    @if $includeUtils {
        @include utils.snippet-input-types(
            $includeBase: $includeBase,
            $includeClrs: false,
            //
            $args...
        );
    }

    &[type='submit'][disabled],
    &[type='reset'][disabled] {
        @include snippet-button-colours(disabled);
    }

    $accentClr: var-theme(input-accent);
    $accentClr_active: var-theme(input-accent-active);
    $accentClr_hover: var-theme(input-accent-hover);

    &[type='checkbox'],
    &[type='radio'] {
        accent-color: #{$accentClr};
        color: #{$accentClr};

        @include hover-focus-visible-or-within {
            accent-color: #{$accentClr_hover};
            color: #{$accentClr_hover};
        }

        &:active {
            accent-color: #{$accentClr_active};
            color: #{$accentClr_active};
        }
    }

    &[readonly] {
        $accentClr: var-theme(input-readonly-accent);
        $accentClr_active: var-theme(input-readonly-accent-active);
        $accentClr_hover: var-theme(input-readonly-accent-hover);

        &[type='checkbox'],
        &[type='radio'] {
            accent-color: #{$accentClr};
            color: #{$accentClr};

            @include hover-focus-visible-or-within {
                accent-color: #{$accentClr_hover};
                color: #{$accentClr_hover};
            }

            &:active {
                accent-color: #{$accentClr_active};
                color: #{$accentClr_active};
            }
        }
    }
}

///
/// Base styles for a form label, including check and radio boxes.
///
/// @since 0.1.0-alpha
///
@mixin snippet-label(
    $color: var-theme(text-primary),
    $color_checkradio: var-theme(text),
    //
    $fontWeight: var-style(input-label-font-weight),
    $fontWeight_checkradio: 400,
    $gap_checkradio: var-mrg-soft('300'),
    $lineHeight: var-style(input-label-line-height),
    $lh_checkradio: var-line-height('400'),
    $marginBlock: var-style(input-margin-block-start) 0,
    $marginBlock_innercheckradio: var-style(input-margin-block-gap),
    //
    $includeUtils: true,
    $args...
) {
    $args: meta.keywords($args);

    @if $includeUtils {
        @include utils.snippet-label(
            $color: $color,
            $color_checkradio: $color_checkradio,
            //
            $fontWeight: $fontWeight,
            $fontWeight_checkradio: $fontWeight_checkradio,
            $gap_checkradio: $gap_checkradio,
            $lineHeight: $lineHeight,
            $lh_checkradio: $lh_checkradio,
            $marginBlock: $marginBlock,
            $marginBlock_innercheckradio: $marginBlock_innercheckradio,
            //
            $includeClrs: false,
            $args...
        );
    }

    & {
        @if not $includeUtils {
            margin-block: #{$marginBlock};
            font-weight: #{$fontWeight};
            line-height: #{$lineHeight};
        }

        color: #{$color};

        &:has(> :where(input[type='checkbox'], input[type='radio'])) {
            @if not $includeUtils {
                gap: #{$gap_checkradio};

                font-weight: #{$fontWeight_checkradio};
                line-height: #{$lh_checkradio};

                cursor: pointer;
            }

            color: #{$color_checkradio};

            & + & {
                margin-block-start: #{$marginBlock_innercheckradio};
            }

            + %_input-base {
                margin-block-start: #{$marginBlock};
            }
        }
    }
}
