///
/// @package @maddimathon/design-system-utilities@___CURRENT_VERSION___
/// @since 0.1.0-alpha
///

@use 'pkg:@maddimathon/utility-sass/list';
@use 'pkg:@maddimathon/utility-sass/map';
@use 'pkg:@maddimathon/utility-sass/meta';
@use 'pkg:@maddimathon/utility-sass/selector';

@use '../../../config';
@use '../../../tokens';

@use '../../01-functions' as *;

@function _font-src-list($list, $isVariable: false) {
    $_list: ();

    $_srcSuffix: if($isVariable, ' tech(variations)', '');

    @each $map in $list {
        $type: map.get($map, type);
        $paths: map.get($map, path);

        @if meta.type-of($paths) != list {
            $paths: ($paths);
        }

        @each $path in $paths {
            $_list: list.append(
                $_list,
                if(
                    $type == local,
                    "local('#{$path}')#{$_srcSuffix}",
                    'url("#{config.$path_fonts}#{$path}") format("#{$type}")#{$_srcSuffix}'
                ),
                $separator: comma
            );
        }
    }

    @return $_list;
}

$_designSystemHasFontFamilies: tokens-has-font-families();

@mixin _tokens-font-face-style-printer($styleMap, $isVariable: false) {
    @each $style, $fileMap in $styleMap {
        @if map.get($fileMap, printFontFace) {
            @font-face {
                //
                @each $prop, $value in $fileMap {
                    //
                    @if $prop == fallbacks or $prop == printFontFace {
                    } @else if $prop == family {
                        font-family: '#{$value}';
                    } @else if $prop == style or $prop == weight {
                        font-#{$prop}: #{$value};
                    } @else if $prop == src {
                        src: #{_font-src-list(
                                $value,
                                $isVariable: $isVariable
                            )};
                    } @else {
                        #{$prop}: #{$value};
                    }
                }
            }
        }
    }
}

///
/// Prints out the font face declarations based on tokens.
///
/// @since 0.1.0-alpha
///
@mixin tokens-font-face {
    @if $_designSystemHasFontFamilies {
        /* #region Tokens - Font Face */
        @each $slug, $familyMap in map.get(tokens.$designSystem, font, family) {
            //
            $weightMap: map.get($familyMap, weights);

            $fontMap: map.get(
                tokens.$designSystem,
                font,
                family,
                $slug,
                variable
            );

            @if $fontMap != null {
                @include _tokens-font-face-style-printer(
                    $fontMap,
                    $isVariable: true
                );
            } @else {
                @each $weight, $styleMap in $weightMap {
                    //
                    @include _tokens-font-face-style-printer($styleMap);
                }
            }
        }
        /* #endregion Tokens - Font Face */
    }
}

///
/// Prints out the font face declarations based on tokens.
///
/// @since 0.1.0-alpha
///
@mixin tokens-font-family {
    @if $_designSystemHasFontFamilies {
        /* #region Tokens - Font Families */
        #{selector.parent-or-root()} {
            @each $slug in map.keys(map.get(tokens.$designSystem, font, family))
            {
                --ff-#{$slug}: #{font-family-list($slug)};
            }
        }
        /* #endregion Tokens - Font Families */
    }
}
