---
/**
 * @since ___PKG_VERSION___
 *
 * @packageDocumentation
 */

/* import - types */
import type { HTMLAttributes } from 'astro/types';
import type { TokenLevels, TokenLevels_Extended } from '../../ts/02-new-tokens/@types.d.ts';
import type { Tokens_Internal } from '../../ts/02-new-tokens/Tokens.js';
import type { Tokens_Colour_ShadeMap } from '../../ts/02-new-tokens/Colour/Colour_ShadeMap.js';
import type { Tokens_Colour_ShadeMap_Shade } from '../../ts/02-new-tokens/Colour/ShadeMap/ShadeMap_Shade.js';

/* import - functions */

/* import - values */

/* import - components */

/* import - layouts */

/* TYPES ===================================== */

/* PROPS ===================================== */

export interface Props<
    T_ColourName extends string = Tokens_Internal.Default_ColourName,
    T_ExtraLevels extends TokenLevels_Extended = Tokens_Internal.Default_ExtraColourLevels,
> extends Omit<HTMLAttributes<'div'>, 'class'> {
    name: string;
    level: TokenLevels;

    values: {
        [K in keyof Tokens_Colour_ShadeMap_Shade.JsonReturn<T_ColourName, T_ExtraLevels>]?:
            | Tokens_Colour_ShadeMap_Shade.JsonReturn<T_ColourName, T_ExtraLevels>[K]
            | undefined;
    };

    bases?: Tokens_Colour_ShadeMap.JsonReturn<T_ColourName, T_ExtraLevels>;

    heading?: '2'|'3'|'4'|'5'|'6';

    frontmatter?: Omit<Props, 'frontmatter'>;
}

const { 
    bases,
    values,
    heading,
    level, 
    name,
    ...attributes
 }: Props = Astro.props.frontmatter ?? Astro.props;

/* CONSTANTS ===================================== */

function textColorLevel(lvl: typeof level) {

    switch ( lvl ) {
        case '100':
            return '700';

        case '200':
            return '800';

        case '300':
            return '900';

        case '400':
            return '900';

        case '500':
            return '100';

        case '600':
            return '100';

        case '700':
            return '100';

        case '800':
            return '200';

        case '900':
            return '300';
    }
}

/* CONSTANTS ===================================== */

values.hex = values.hex?.replace(/^#/g, '');

const bg = values.hsl ? `hsl( ${ values.hsl.h }, ${ values.hsl.s }%, ${ values.hsl.l }% )` : values.hex ? `#${values.hex}`: null;

const textLevel = values.contrast?.min.base?.text?.aaa?.level
    ?? values.contrast?.min.base?.text?.aa?.level
    ?? values.contrast?.max.base?.level
    ?? textColorLevel(level);

const text = bases && textLevel && bases && textLevel in bases && bases[ textLevel ] 
    && `hsl( ${ bases[ textLevel ].hsl.h }, ${ bases[ textLevel ].hsl.s }%, ${ bases[ textLevel ].hsl.l }% )`;

const brightnessMode = Number(textLevel) > 500 ? 'light' : 'dark';

const HeadingTag = heading ? `h${heading}`  as const : 'p' as const;
--- 

<div
    class:list={['container', 'colour-shade-swatch']}
    style={`${bg ? `background: ${bg};` : ''}${text ? `color: var(--colour-table-color-override, ${text});` : ''}`}
    data-brightness-mode={brightnessMode}
    {...attributes}
>
    <HeadingTag
        class={ HeadingTag == 'p' ? 'heading' : null }
        style={`display: var(--colour-shade-swatch-display-override, block);`}
        set:text={`${name}-${level}`}
    />
    {
        values.hex && (
            <p
                class:list={['colour-value', `colour-value--hex`]}
                style={`display: var(--colour-shade-swatch-display-override, block);`}
            >
                #<strong set:text={values.hex} />
            </p>
        )
    }
    {
        values.hsl && (
            <p
                class:list={['colour-value', `colour-value--hsl`]}
                style={`display: var(--colour-shade-swatch-display-override, block);`}
            >
                <!-- prettier-ignore -->
                hsl(<strong set:text={values.hsl.h} />,{' '}<strong set:text={`${values.hsl.s}%`} />,{' '}<strong set:text={`${values.hsl.l}%`} />)
            </p>
        )
    }
    {
        values.rgb && (
            <p
                class:list={['colour-value', `colour-value--rgb`]}
                style={`display: var(--colour-shade-swatch-display-override, block);`}
            >
                <!-- prettier-ignore -->
                rgb(<strong set:text={values.rgb.r} />,{' '}<strong set:text={`${values.rgb.g}`} />,{' '}<strong set:text={`${values.rgb.b}`} />)
            </p>
        )
    }
    {
        values.lch && (
            <p
                class:list={['colour-value', `colour-value--lch`]}
                style={`display: var(--colour-shade-swatch-display-override, block);`}
            >
                <!-- prettier-ignore -->
                lch(<strong set:text={values.lch.l} />{' '}<strong set:text={`${values.lch.c}`} />{' '}<strong set:text={`${values.lch.h}`} />)
            </p>
        )
    }
</div>

<style lang='scss'>
    @forward '../css/colour-shade-swatch';
</style>
  