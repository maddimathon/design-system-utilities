---
/**
 * @since ___PKG_VERSION___
 *
 * @packageDocumentation
 */

/* import - types */
import type { TokenLevels } from '../../ts/02-tokens/@types.d.ts';
import type { Tokens } from '../../ts/02-tokens/Tokens.js'; 
import type { Tokens_Typography } from '../../ts/02-tokens/Tokens_Typography.js';

/* import - functions */
import { 
    arrayUnique,
    toTitleCase,
} from '@maddimathon/utility-typescript/functions';
import { objectGenerator } from '../../ts/01-utilities/objectGenerator.js';
import { objectMap } from '../../ts/01-utilities/objectMap.js';
 
/* import - values */

/* import - components */
import Toggle from '@maddimathon/utility-astro/components/Toggle';
import Heading from '@maddimathon/utility-astro/components/Heading';
// import VariableDump from '@maddimathon/utility-astro/components/VariableDump';

/* import - layouts */

/* PROPS ===================================== */

export interface Props {
    tokens: Tokens.JsonReturn;
}

const { tokens }: Props = Astro.props;

/* FUNCTIONS ===================================== */

function detailsMapper( font: Tokens_Typography.Font.Family<string> ) {

    return Object.values( objectMap(
        font,
        ( { key, value } ) => {

            // returns on match
            switch (key) {

                case 'name':
                    return { 
                        key: toTitleCase(key),
                        value,
                    };

                case 'appendSystemFontsToFallbacks':
                case 'printFontFace':
                case 'display':
                case 'weights':
                    return false;

                case 'contentWidthScale':
                    return import.meta.env.DEV ? {
                        key: 'Content Width Scale',
                        value,
                    } : false;
 
                case 'fallbacks':
                    if(Array.isArray(value) ) {
                        return value.length ? {
                            key: 'Fallbacks',
                            value: value.join(', '),
                        } : false;
                    } else if (!value) {
                        return false;
                    }
                    break;

                case 'fontOverrideOption':
                    return import.meta.env.DEV ? {
                        key: 'Font Override Option',
                        value,
                    } : false;

                case 'lineGapOverride':
                    return import.meta.env.DEV ? {
                        key: 'Line Gap Override',
                        value,
                    } : false;

                case 'lineHeightScale':
                    return import.meta.env.DEV ? {
                        key: 'Line Height Scale',
                        value,
                    } : false;

                case 'sizeAdjust':
                    return {
                        key: 'Relative Size',
                        value,
                    };

                case 'slug':
                    return {
                        key: 'Role',
                        value,
                    };

                case 'unicodeRange':
                    return {
                        key: 'Unicode Range',
                        value,
                    };
            }
                
            return false;
        }
    ) ).filter( v => v !== false );
}

/* CONSTANTS ===================================== */

const defaultToggleToOpen = import.meta.env.DEV ? true : undefined;

const sortedFontKeys: ( keyof typeof tokens.typography.fonts )[] = arrayUnique(
    (
        [
            'heading',
            'body',
            'monospace',
            'hyperlegible',
            'serif',
            ...(Object.keys(tokens.typography.fonts) as ( keyof typeof tokens.typography.fonts )[]).filter( v => v != 'dyslexic'),
            'dyslexic',
        ] as const
    ).filter( key => key in tokens.typography.fonts )
);

const sortedFonts = objectGenerator(
    sortedFontKeys,
    (key) => tokens.typography.fonts[key]
) as typeof tokens.typography.fonts;

const allFontLevels = arrayUnique(
    Object.values(tokens.typography.fonts)
        .map( ( { weights } ) => Object.keys(weights) as TokenLevels[] )
        .flat()
).sort();
---

<Toggle
    defaultOpen={defaultToggleToOpen}
    heading={2}
    id='sizes'
>
    <Fragment slot='button'>Font Weights</Fragment>
    <div 
        class='font-family-swatch-list'
        style={`--font-family-list-column-count: ${Object.keys( tokens.typography.fonts ).length}`}
    >
        {
            Object.values(sortedFonts).map((font) => (
                <article 
                    class='font-family-swatch'
                    data-font-family-override={font.slug}
                    style={`font-family: var(--ff-${font.slug}, "${font.name}")`}
                >
                    <h3
                        class:list={['font-family-swatch__name']}
                        set:text={font.name}
                    />
                    <dl class='font-family-swatch__details-list'>
                        { detailsMapper(font).map( ( {key, value} ) => (
                            <dt
                                class:list={[ 'h7', '|', 'font-family-swatch__details-dt' ]}
                                set:text={key} 
                            />
                            <dd
                                class:list={[ 'font-family-swatch__details-dd' ]}
                                set:text={value}
                            />
                        ) ) }
                    </dl>
                    {allFontLevels.map(( weight ) => font.weights[weight] && ( [ 'normal', 'italic' ] as const ).map( style => (
                        <Heading
                            heading={4}
                            displayHeading={6}

                            class:list={[
                                'font-family-swatch__weight-dt',
                                `font-family-swatch__weight-dt--${ style == 'italic' ? `${weight}-${style}` : weight }`, 
                            ]}
                            style={ [
                                `font-style: ${style}`,
                            ].join(';') }
                            set:text={ style === 'italic' ? `${weight} (${style})`: weight }
                        />
                        <p
                            class:list={[
                                'font-family-swatch__weight-dd',
                                `font-family-swatch__weight-dd--${ style == 'italic' ? `${weight}-${style}` : weight }`,
                            ]}
                            style={ [ 
                                `--line-clamp: ${ import.meta.env.DEV ? 5 : 3 }`,
                                `font-style: ${style}`,
                                `font-weight: ${weight}`,
                            ].join(';') }
                            set:text={`Maecenas facilisis sollicitudin nisi, eget pellentesque dui rhoncus condimentum. Vivamus vulputate nisl sit amet vehicula commodo. Suspendisse pharetra varius ipsum, sed scelerisque ipsum tempor eget. Curabitur mollis lacus eu augue vestibulum semper. Praesent rutrum velit sodales ante varius convallis. Proin ut gravida sem. Nulla ac sapien odio. Cras neque arcu, fermentum non elementum ac, tincidunt ut nibh. Proin blandit, nisl at volutpat pulvinar, massa nisl vulputate risus, eget porttitor neque mi id augue. Integer porttitor egestas facilisis. Quisque eget nibh hendrerit, ornare nisl sit amet, faucibus enim.`}
                        />
                    ) ))}
                </article>
            ))
        }
    </div>
</Toggle>

<style lang='scss'>
    @forward '../scss/page-content-font-families';
</style>
