---
/**
 * @since ___PKG_VERSION___
 *
 * @packageDocumentation
 */

/* import - types */
import type { ArrayItem } from '@maddimathon/utility-typescript/types';

/* import - functions */
import { getCollection } from 'astro:content';
import * as YAML from 'yaml';

import * as UA from '@maddimathon/utility-astro';
import { relativeURL } from '../functions/relativeURL.js';

/* import - values */

/* import - components */
import CodeBlock from '@maddimathon/utility-astro/components/CodeBlock';
import NestedList from '@maddimathon/utility-astro/components/NestedList';
import Toggle from '@maddimathon/utility-astro/components/Toggle';

/* import - layouts */
import DocsPage from '../layouts/DocsPage.astro';

/* TYPES ===================================== */

/* FUNCTIONS ===================================== */

/* CONSTANTS ===================================== */

const rawCollection = await getCollection('api');

const collectionTree = new UA.typedoc.CollectionTree(
    rawCollection.map(
        (_page) =>
            ({
                ..._page,
                href: relativeURL(Astro.url, `api/${_page.id}`),
            }) as const satisfies ArrayItem<typeof rawCollection> & {
                href: string;
            }
    )
);
---

<DocsPage title='Exports'>
    <Toggle
        id='page-props-collectionTree-exportList'
        heading={2}
    >
        <Fragment
            slot='button'
            set:text='collectionTree.exportList()'
        />
        <NestedList list={Object.values(collectionTree.exportList())} />
    </Toggle>

    <hr />

    <Toggle
        id='page-props-collectionTree-exportMap'
        heading={2}
    >
        <Fragment
            slot='button'
            set:text='collectionTree.exportMap()'
        />
        <CodeBlock lang='yaml'>
            <Fragment set:html={YAML.stringify(collectionTree.exportMap())} />
        </CodeBlock>
    </Toggle>

    <hr />

    <Toggle
        id='page-props-collectionTree-pages'
        heading={2}
    >
        <Fragment
            slot='button'
            set:text='collectionTree.pages'
        />
        <CodeBlock lang='yaml'>
            <Fragment set:html={YAML.stringify(collectionTree.pages)} />
        </CodeBlock>
    </Toggle>

    <hr />

    <Toggle
        id='page-props-collectionTree-map'
        heading={2}
    >
        <Fragment
            slot='button'
            set:text='collectionTree.map'
        />
        <CodeBlock lang='yaml'>
            <Fragment set:html={YAML.stringify(collectionTree.map)} />
        </CodeBlock>
    </Toggle>

    <hr />
</DocsPage>
