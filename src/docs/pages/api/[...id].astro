---
/**
 * @since ___PKG_VERSION___
 *
 * @packageDocumentation
 */

/* import - types */

/* import - functions */
import { getCollection, render } from 'astro:content';
import * as YAML from 'yaml';

/* import - values */

/* import - components */
import CodeBlock from '@maddimathon/utility-astro/components/CodeBlock';
import Toggle from '@maddimathon/utility-astro/components/Toggle';

/* import - layouts */
import DocsPage from '../../layouts/DocsPage.astro';

/* TYPES ===================================== */

/* EXPORT PATHS ===================================== */

export async function getStaticPaths() {
    const posts = await getCollection('api');

    return posts.map((_post) => {
        const html = _post.rendered?.html?.replace(
            /(?<= href="[^"]+)\.md"/g,
            '.html"'
        );

        return {
            params: { id: _post.id },
            props: {
                ..._post,
                title: _post.data.name,
                html,
            },
        };
    });
}

/* CONSTANTS ===================================== */

const props = Astro.props;

const { Content } = await render(props);

const title = props.title;

const varDump = {
    id: props.id,
    title: props.title,
    filePath: props.filePath,
    data: props.data,
    collection: props.collection,
};
---

<DocsPage title={title}>
    <Fragment set:html={props.html} />

    <Toggle
        id='page-props-vardump'
        heading={2}
    >
        <Fragment
            slot='button'
            set:text='Page Properties'
        />
        <!-- <VariableDump var={varDump} name="props" /> -->
        <CodeBlock lang='yaml'
            ><Fragment set:html={YAML.stringify(varDump)} /></CodeBlock
        >
    </Toggle>

    <hr />

    <Content />
</DocsPage>
